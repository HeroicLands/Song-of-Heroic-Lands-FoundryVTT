{{!--
This file is part of the Song of Heroic Lands (SoHL) system for Foundry VTT.
Copyright (c) 2024â€“2026 Tom Rodriguez ("Toasty") <toasty@heroiclands.com>

Licensed under the GNU General Public License v3.0 (GPLv3).
You may copy, modify, and distribute this file under the terms of that license.

See LICENSE.md in the project root or:
https://www.gnu.org/licenses/gpl-3.0.html

SPDX-License-Identifier: GPL-3.0-or-later
--}}

<form class="{{cssClass}}" autocomplete="off">
    {{> "sohl.item-header"}}

    {{!-- Sheet Tab Navigation --}}
    <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item" data-tab="properties">Common</a>
        <a class="item" data-tab="description">Description</a>
        <a class="item" data-tab="actions">Actions</a>
        <a class="item" data-tab="nesteditems">Nested</a>
        <a class="item" data-tab="effects">Effects</a>
    </nav>

    {{!-- Sheet Body --}}
    <section class="tab-body">
        {{!-- Properties Tab --}}
        <div class="tab properties" data-group="primary" data-tab="properties">
            <div class="grid grid-2col">
                {{#if (eq idata.subType "ancestor")}}
                {{formField fields.domain rootId="mysticalability-domain" label="Skill" classes="text-field" stacked=true value=system.domain}}
                {{formField fields.levelBase rootId="mysticalability-level" label="Anima" classes="text-field" stacked=true value=system.levelBase}}
                {{/if}}
                {{#if (eq idata.subType "totem")}}
                {{formField fields.levelBase rootId="mysticalability-level" label="Anima" classes="text-field" stacked=true value=system.levelBase}}
                {{/if}}
                {{#if (eq idata.subType "energy")}}
                <div class="form-group stacked text-field">
                    <label>Energy Spirit</label>
                    <div class="form-fields">
                        <select class="value" name="system.domain">
                            {{selectOptions config.Item.dataModels.mysticalability.energySpiritPowerTypes selected=idata.domain}}
                        </select>
                    </div>
                </div>
                {{formField fields.levelBase rootId="mysticalability-level" label="Anima" classes="text-field" stacked=true value=system.levelBase}}
                {{/if}}
                {{#if (or (eq idata.subType "benediction") (eq idata.subType "devotion") (eq idata.subType "faith"))}}
                {{formField fields.domain rootId="mysticalability-domain" label="Ritual" classes="text-field" stacked=true value=system.domain}}
                {{/if}}
                {{#if (eq idata.subType "grace")}}
                {{formField fields.domain rootId="mysticalability-domain" label="Divinity" classes="text-field" stacked=true value=system.domain}}
                {{/if}}
                {{#if (eq idata.subType "arcaneincanting")}}
                {{formField fields.domain rootId="mysticalability-domain" label="Convocation" classes="text-field" stacked=true value=system.domain}}
                {{/if}}
                {{#if (eq idata.subType "arcaneinvocation")}}
                {{formField fields.domain rootId="mysticalability-domain" label="Convocation" classes="text-field" stacked=true value=system.domain}}
                {{formField fields.levelBase rootId="mysticalability-level" classes="text-field" stacked=true value=system.levelBase}}
                {{formField fields.masteryLevelBase rootId="mysticalability-ml" label="Mastery Level" classes="text-field" stacked=true value=system.masteryLevelBase}}
                {{/if}}
                {{#if (eq idata.subType "divineincantation")}}
                {{formField fields.domain rootId="mysticalability-domain" label="Ritual" classes="text-field" stacked=true value=system.domain}}
                {{formField fields.levelBase rootId="mysticalability-level" label="Circle" classes="text-field" stacked=true value=system.levelBase}}
                {{formField fields.masteryLevelBase rootId="mysticalability-ml" label="Mastery Level" classes="text-field" stacked=true value=system.masteryLevelBase}}
                {{/if}}
                {{#if (eq idata.subType "arcanetalent")}}
                {{formField fields.masteryLevelBase rootId="mysticalability-ml" label="Mastery Level" classes="text-field" stacked=true value=system.masteryLevelBase}}
                {{/if}}
            </div>
            {{#if (eq idata.subType "totem")}}
            <fieldset
                class="mysticalability-totem-instinct-list"
                id="mysticalability-totem-instinct-list">
                <legend>Totem Instincts</legend>
                <div class="mysticalability-totem-instinct-add flexrow">
                    <a
                        class="add-array-item"
                        data-array="flags.sohl.instincts"
                        data-dtype="String"
                        data-default-value=""
                        data-title="Instinct"
                        ><i class="fas fa-plus"></i> Add Skill</a
                    >
                </div>
                <ol class="grid grid-4col">
                    {{#each flags.sohl.instincts}}
                    <li class="mysticalability-totem-instinct">
                        <span class="name">{{this}}</span>
                        <a
                            class="delete-array-item"
                            data-array="flags.sohl.instincts"
                            data-value="{{this}}"
                            title="Instinct"
                            ><i class="fas fa-trash"></i
                        ></a>
                    </li>
                    {{/each}}
                </ol>
            </fieldset>
            {{/if}} {{> "sohl.item-refnote"}}
        </div>

        {{!-- Description Tab --}}
        <div
            class="tab description"
            data-group="primary"
            data-tab="description">
            {{editor idata.description target="system.description" button=true
            owner=owner editable=editable}}
        </div>

        {{!-- Actions Tab --}}
        <div class="tab actions" data-group="primary" data-tab="actions">
            {{> "sohl.item-actions-list"}}
        </div>

        {{!-- Nested Items Tab --}}
        <div
            class="tab nesteditems"
            data-group="primary"
            data-tab="nesteditems">
            {{> "sohl.item-nesteditems-list"}}
        </div>

        {{!-- Effects Tab --}}
        <div class="tab effects" data-group="primary" data-tab="effects">
            {{> "sohl.item-active-effects"}}
        </div>
    </section>
</form>
